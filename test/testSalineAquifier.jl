using Test
include("../src/SalineAquifier_3D_multixpu.jl")

@testset "3D" begin
    # unit tests for boundary function
    A = rand(5,5,5)
    A = Data.Array(A)
    @parallel (1:size(A, 2), 1:size(A, 3)) bc_x!(A)
    @parallel (1:size(A, 1), 1:size(A, 3)) bc_y!(A)
    @parallel (1:size(A, 1), 1:size(A, 2)) bc_z!(A)
    @test A[1  , :, :]      == A[2    ,  :, :]
    @test A[end, :, :]      == A[end-1, :, :]
    @test A[:  , 1, :]      == A[:    ,  2, :]
    @test A[end, :, :]      == A[end-1, :, :]
    # ref test
    T, C = SalineAquifier3D(;nz=3,nt=3,do_viz=false)
    print(T)
    @test isapprox(T, [100.0 100.0 100.0; 100.0 100.0 100.0; 100.0 100.0 100.0; 100.0 100.0 100.0; 100.0 100.0 100.0; 100.0 100.0 100.0; 100.0 100.0 100.0;;; -8.904991376807152 -8.904991376807152 -8.904991376807152; -8.904991376807152 -8.904991376807152 -8.904991376807152; -20.408198019470397 -20.408198019470397 -20.408198019470397; 143.01824406675433 143.01824406675433 143.01824406675433; -20.408198019470397 -20.408198019470397 -20.408198019470397; -8.904991376807152 -8.904991376807152 -8.904991376807152; -8.904991376807152 -8.904991376807152 -8.904991376807152;;; -100.0 -100.0 -100.0; -100.0 -100.0 -100.0; -100.0 -100.0 -100.0; -100.0 -100.0 -100.0; -100.0 -100.0 -100.0; -100.0 -100.0 -100.0; -100.0 -100.0 -100.0])
    @test isapprox(C, [3.474447819732843e-7 3.474447819732843e-7 3.474447819732843e-7; 3.474447819732843e-7 3.474447819732843e-7 3.474447819732843e-7; 3.868601696352901e-5 3.868601696352901e-5 3.868601696352901e-5; 0.002911000781465322 0.002911000781465322 0.002911000781465322; 3.868601696352901e-5 3.868601696352901e-5 3.868601696352901e-5; 3.474447819732843e-7 3.474447819732843e-7 3.474447819732843e-7; 3.474447819732843e-7 3.474447819732843e-7 3.474447819732843e-7;;; 3.474447819732843e-7 3.474447819732843e-7 3.474447819732843e-7; 3.474447819732843e-7 3.474447819732843e-7 3.474447819732843e-7; 3.868601696352901e-5 3.868601696352901e-5 3.868601696352901e-5; 0.002911000781465322 0.002911000781465322 0.002911000781465322; 3.868601696352901e-5 3.868601696352901e-5 3.868601696352901e-5; 3.474447819732843e-7 3.474447819732843e-7 3.474447819732843e-7; 3.474447819732843e-7 3.474447819732843e-7 3.474447819732843e-7;;; 3.474447819732843e-7 3.474447819732843e-7 3.474447819732843e-7; 3.474447819732843e-7 3.474447819732843e-7 3.474447819732843e-7; 3.868601696352901e-5 3.868601696352901e-5 3.868601696352901e-5; 0.002911000781465322 0.002911000781465322 0.002911000781465322; 3.868601696352901e-5 3.868601696352901e-5 3.868601696352901e-5; 3.474447819732843e-7 3.474447819732843e-7 3.474447819732843e-7; 3.474447819732843e-7 3.474447819732843e-7 3.474447819732843e-7])
end;